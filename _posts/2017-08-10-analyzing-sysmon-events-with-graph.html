---
layout: post
title: Analyzing sysmon events with graph
date: 2017-08-10 13:37:07.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '8124056987'
  _publicize_failed_18229674: O:13:"Keyring_Error":2:{s:6:"errors";a:1:{s:21:"keyring-request-error";a:1:{i:0;a:6:{s:7:"headers";O:42:"Requests_Utility_CaseInsensitiveDictionary":1:{s:7:"
author:
  login: eosfor
  email: eosfor@gmail.com
  display_name: eosfor
  first_name: ''
  last_name: ''
---
<p>Hello colleagues, this is an example I promised answering <a href="https://twitter.com/cyb3rops/status/895024725730238464">this tweet</a>. I used https://github.com/SwiftOnSecurity/sysmon-config<a href="https://github.com/SwiftOnSecurity/sysmon-config">this</a> sysmon config to capture activities happening on my system. Unfortunately it did not capture a lot of network-related activities, perhaps I need to change it to extend network-level filters. But on the other hand it captured a lot of process level activities, so in this example i'd like to try to graph process creation events.<br />
So first thing to do in this case is create a graph object</p>
<p>[code language="powershell"]<br />
$g = New-Graph -Type BidirectionalGraph<br />
[/code]</p>
<p>And now we can fill in the graph with some data right from the event log. It may take few seconds until all events will be processed</p>
<p>[code language="powershell"]<br />
Get-WinEvent -LogName Microsoft-Windows-Sysmon/Operational | ? {$_.id -eq 1} |<br />
    % { if ($_.properties[3]) {Add-Edge -From $_.Properties[-2].value -To $_.properties[3].value -Graph $g}} |<br />
    Out-Null<br />
[/code]</p>
<p>And then we just display the graph</p>
<p>[code language="powershell"]<br />
Show-GraphLayout -Graph $g<br />
[/code]</p>
<p>This is how it looks like<br />
https://youtu.be/LuRo8GEwp1w</p>
