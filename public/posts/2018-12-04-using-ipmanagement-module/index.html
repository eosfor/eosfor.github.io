<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Using IP management module - Modern IT Engineer</title>
<meta name="description" content="How to use ipmgmt powershell module">
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Modern IT Engineer",
    
    "url": "https:\/\/eosfor.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/eosfor.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/eosfor.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/eosfor.github.io\/posts\/2018-12-04-using-ipmanagement-module\/",
          "name": "Using IP management module"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Using IP management module",
  "description" : "How to use ipmgmt powershell module",
  "inLanguage" : "en",
  "wordCount":  484 ,
  "datePublished" : "2018-12-04T01:38:48",
  "dateModified" : "2018-12-04T01:38:48",
  "image" : "https:\/\/eosfor.github.io",
  "keywords" : [ "PowerShell" ],
  "mainEntityOfPage" : "https:\/\/eosfor.github.io\/posts\/2018-12-04-using-ipmanagement-module\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/eosfor.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/eosfor.github.io",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:url" content="https://eosfor.github.io/posts/2018-12-04-using-ipmanagement-module/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Modern IT Engineer">
   
<link rel="apple-touch-icon" sizes="180x180" href=" https://eosfor.github.io/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://eosfor.github.io/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://eosfor.github.io/favicon/favicon-16x16.png">


<meta name="generator" content="Hugo 0.119.0"><link rel="alternate" href="https://eosfor.github.io/index.xml" type="application/rss+xml" title="Modern IT Engineer">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://eosfor.github.io/css/main.css">
<link disabled id="dark-mode-theme" rel="stylesheet" href="https://eosfor.github.io/css/dark.css"><link rel="stylesheet" href="https://eosfor.github.io/css/syntax.css"><link rel="stylesheet" href="https://eosfor.github.io/css/codeblock.css">







  </head>
  <body>
    
<div class="container fixed-top">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-12 col-lg-10 col-xl-10">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top p-0">
        <div class="container">
          
          <a class="navbar-brand fw-bold" href="https://eosfor.github.io">Modern IT Engineer</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav mb-2 mb-lg-0">
              

              
              <li class="nav-item nav-link">
                <a id="dark-mode-toggle" class="bi bi-sun"></a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>
    









<header class="header-section ">

  <div class="intro-header no-img mt-10">
    <div class="container">
      <div class="row justify-content-center">
        

          
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            

            <div class="posts-heading">
              

              

              
              <h1 class="fw-semibold display-5 lh-1 mb-3"> 
                Using IP management module
                
              </h1>
              
              

              

              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 ">

      <div class="card-image card-image-blog p-0">
        
        
      </div>
    </div>
 
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
      <article role="main" class="blog-post">
        <p>Ok, now lets start using this thing. Assume we&rsquo;ve got three different ranges &lsquo;10.192.0.0/11&rsquo;, &lsquo;10.64.0.0/11&rsquo; and &lsquo;10.128.0.0/11&rsquo;. These ranges correspond to three different geographic locations in Azure. There are already some ranges used in these top level blocks. And we have the whole list of ranges, which are in use already. So what we want to achieve is we want to automatically select the next available range and provision VNET for it.</p>
<h1 id="the-process">The process</h1>
<p>Lets say we&rsquo;ve extracted all VNET ranges and got their list, like this:</p>
<p>{{ page.beginps }}
$nets = &lsquo;10.192.1.0/24&rsquo;,&lsquo;10.192.2.0/24&rsquo;,&lsquo;10.192.3.0/24&rsquo;,&lsquo;10.192.6.0/24&rsquo;,
&lsquo;10.192.7.0/24&rsquo;,&lsquo;10.192.8.0/24&rsquo;,&lsquo;10.192.9.0/24&rsquo;,&lsquo;10.64.1.0/24&rsquo;,
&lsquo;10.64.2.0/24&rsquo;,&lsquo;10.64.3.0/24&rsquo;,&lsquo;10.64.4.0/24&rsquo;,&lsquo;10.64.5.0/24&rsquo;,
&lsquo;10.64.8.0/24&rsquo;,&lsquo;10.64.9.0/24&rsquo;,&lsquo;10.128.1.0/24&rsquo;,&lsquo;10.128.2.0/24&rsquo;,
&lsquo;10.128.4.0/24&rsquo;,&lsquo;10.128.5.0/24&rsquo;,&lsquo;10.128.7.0/24&rsquo;,&lsquo;10.128.8.0/22&rsquo;
{{ page.endps }}</p>
<p>Assume we need to find the next range of size /22 in the network &lsquo;10.64.0.0/11&rsquo;. We do it this way:</p>
<p>{{ page.beginps }}
Get-IPRanges -Networks $nets -CIDR 22 -BaseNet &ldquo;10.64.0.0/11&rdquo; | ft -AutoSize
{{ page.endps }}</p>
<p><img src="/images/posts/2018-12-04-16-40-18.png" alt="fisttest"></p>
<p>What this output shows is the list of your networks, marked by IsFree flag. Basically, it assumes that if the range is in the list, then it is in use. The row, where IsFree is true, is the range that the commandlet identified as a next available slot for your network. Lets try another one</p>
<p>{{ page.beginps }}
Get-IPRanges -Networks $nets -CIDR 24 -BaseNet &ldquo;10.64.0.0/11&rdquo; | ft -AutoSize
{{ page.endps }}</p>
<p>In this case output is a bit different. First two ranges, which have been identified fits one of free slots that the base network range has. And the last one, is the slot at the end of the list of occupied ranges.</p>
<p><img src="/images/posts/2018-12-04-16-40-51.png" alt="secondtest"></p>
<p>So if we want to filter out just those, that we are interested in, we can do like below, so we can pick one of these.</p>
<p>{{ page.beginps }}
Get-IPRanges -Networks $nets -CIDR 24 -BaseNet &ldquo;10.64.0.0/11&rdquo; | ? isfree -eq $true | ft -AutoSize
{{ page.endps }}</p>
<p><img src="/images/posts/2018-12-04-16-44-26.png" alt="thirdtest"></p>
<p>Ok, lets say we&rsquo;ve chosen &lsquo;10.64.6.0/24&rsquo;. Next step is to break it down by subnets, if needed. Let say that because of some corporate policies we want to have four subnets in this VNET. First subnet will be reserved for Gateway subnet, then we have a DMZ subnet, to put our WAF, as no other devices is supported in the WAF subnet. Next subnet, we call it EDGE - is basically a subnet we put put our WEB-facing VMs into, then APP - for application layer, and BKE - for data layer. In order to do this automatically we need to have a range we picked up on the previous step. And we need to define a layout. We need also to specify a size of each subnet in number of IPs. Like below.</p>
<p>{{ page.beginps }}
$subnets = @{type = &ldquo;GTWSUBNET&rdquo;; size = 30},
@{type = &ldquo;DMZSUBNET&rdquo;; size = 62},
@{type = &ldquo;EDGSUBNET&rdquo;; size = 30},
@{type = &ldquo;APPSUBNET&rdquo;; size = 62},
@{type = &ldquo;BKESUBNET&rdquo;; size = 62}</p>
<p>Get-VLSMBreakdown -Network 10.64.6.0/24 -SubnetSize $subnets | ft -AutoSize
{{ page.endps }}</p>
<p>This will be our VNET breakdown, by subnets</p>
<p><img src="/images/posts/2018-12-04-16-53-13.png" alt="breakdown"></p>

      </article>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
      <hr />
    </div>
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-2">
        
          <div class="blog-tags">
            
              <a href="https://eosfor.github.io/tags/powershell/">PowerShell</a>
            
          </div>
        
      </div>
 
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
      
    </div>

    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 mt-3">
      <div class="card">
        <div class="row no-gutters">
          <div class="col-md-2 "> 
            <div class="card-body ">
            <img src="/img/bino-about-small.jpg" class="img-responsive img-50 img-round" alt="">
          </div>
          </div>
          <div class="col-md-10">
            <div class="card-body p-1.1">

              <p class="p-0 m-0"><small class="text-muted ">Written By</small></p>
              <h5>
                
                
                
                
                
              </h5>
              <p class="card-text fs-1"></p>
            </div>
          </div>
        </div>

      
    </div>
  </div>

      <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
        
        <ul class="list-group list-group-horizontal" style="flex-direction: row">
          
          <li class="list-group-item b-0">

            <a type="button" class="btn btn-dark" role="button" href="https://eosfor.github.io/posts/2018-08-04-considerations-when-running-private-aks/"
              data-toggle="tooltip" data-placement="top" title="Considerations when running private AKS cluster">&larr;
              Previous Post</a>
          </li>
          


          
          <li class="list-group-item ms-auto b-0">
            <a type="button" class="btn btn-dark" role="button" href="https://eosfor.github.io/posts/2020-06-25-https-custom-domain-for-a-storage-account/"
              data-toggle="tooltip" data-placement="top" title="How to attach HTTPS custom domain to a storage account-based static website">Next Post
              &rarr;</a>
          </li>
          
        </ul>
        
      </div>

      <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4"> 
      </div>
    </div>
  </div>

  <div class="">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 mt-3">
          <h3>Read more</h3>
          <hr />
        </div>

        
      </div>
    </div>

    

  </div>
</div>
</div>

    


<footer>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ul
          class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row">

          
          
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
          2020
          

          
          &nbsp;&bull;&nbsp;
          <a href="https://eosfor.github.io">Modern IT Engineer</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Powered by <a href="https://gohugo.io">Hugo</a> & <a href="https://github.com/binokochumolvarghese/lightbi-hugo">Lightbi.</a>&nbsp; Made with ‚ù§ by <a href="https://binovarghese.com">Bino</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script><script src="https://eosfor.github.io/js/dark-mode.js"></script>
    
  </body>
</html>

